#!/usr/bin/env coffee
fs            = require 'fs'
path          = require 'path'
{spawn, exec} = require 'child_process'

# npm
CoffeeScript = require '../node_modules/coffee-script'
optimist = require('../node_modules/optimist')

usage = '''
  Usage:
    courier [OPTIONS] [PATH_TO_APP = "."]
'''

argv = optimist.usage(usage).argv

if argv.v || argv.version
  console.log fs.readFileSync './VERSION', 'utf8'
  process.exit 0

fs.readFile 'package.coffee', 'utf8', (error, coffee) ->
  throw error if error

  js = CoffeeScript.compile "return #{coffee}"
  json = JSON.stringify eval(js), null, 2

  fs.writeFile 'package.json', json, ->
    console.log json if argv.p || argv.print
